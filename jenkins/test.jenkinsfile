pipeline {
  agent { node { label 'ruby' } }
  stages {
    stage('Setup') {
      steps {
        sh '''
          sudo apt update && sudo apt -y install build-essential patch ruby-dev zlib1g-dev liblzma-dev
          bundle install
        '''
      }
    }
    stage('RSpec') {
      steps {
        sh 'rake'
      }
    }
    stage('Cleanup') {
      steps {
        sh 'bundle clean --force'
      }
    }
  }
}